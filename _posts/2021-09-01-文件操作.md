---
layout: post
title:  C 语言文件操作
date:   2021-09-01 15:40:35 +0300
image:  2.jpg
tags:   文件操作
---

在此总结 C 语言中基本的文件操作（函数运用）。

首先清楚，一次完整的文件操作应该包括：打开文件 --> 读写文件 --> 关闭文件。（关闭文件时常会被遗忘）

以下所有函数均包含在头文件 <stdio.h> 中。

# 一、fopen() 打开文件

函数原型：

```FILE *fopen(char *filename, char *mode);```

`filename`为文件名（包括文件路径），`mode`为打开方式，它们都是字符串。

fopen() 会获取文件信息，包括文件名、文件状态、当前读写位置等，并将这些信息保存到一个 FILE 类型的结构体变量中，然后将该变量的地址返回。打开文件出错时，fopen() 将返回一个空指针，也就是 NULL，我们可以利用这一点来判断文件是否打开成功。

FILE 是 <stdio.h> 头文件中的一个结构体，它专门用来保存文件信息。

举例：

`FILE *fp = fopen("demo.txt", "r");` 相对路径

`FILE *fp = fopen("D:\\demo.txt","r");` 绝对路径

由于文件打开可能会失败，因此最好加入判断语句：

```c++
FILE *fp;
if( (fp=fopen("D:\\demo.txt","rb")) == NULL ){
    printf("Fail to open file!\n");
    exit(0);  //退出程序（结束程序）
}
```

<br>

## 打开方式

| 打开方式 | 说明                                   |
| -------- | -------------------------------------- |
| r        | 只读（文件必须存在）                   |
| w        | 只写（文件不存在则新建，若存在会清空） |
| a        | 追加（文件不存在则新建）               |
| r+       | 读写                                   |
| w+       | 写入/更新（ w 加 r+）                  |
| a+       | 追加/更新（ a 加 r+）                  |
| t        | 文本文件（默认）                       |
| b        | 二进制文件                             |

最后两项控制**读写方式**，写在控制**读写权限**的字符串之后。

<br>



## 文本文件与二进制文件的区别

这里顺便就提一下文本（ASCII）文件和二进制文件的区别：

**实际上没有什么区别**。因为无论是什么文件，终归还是以二进制形式存储在计算机中的。其不同之处实际在于读写方式：

举个例子，对于 5678 这个数，如果是文本文件，则以 ASCII 码存储，一个字符占一个字节，会得到 00110101 00110110 00110111 00111000 ；而如果是二进制文件，则 5678 就是五千六百七十八这个数，会以二进制 00010110 00101110 存储，占两个字节。

实际是两种不同的编码方式进行存储。

那么在读取的时候就不难理解，如果用文本编辑器打开文本文件，那么可以正确解析得到结果，而如果用它打开二进制文件，由于编码规则不同，则无法正确解析，得到的就是乱码。

所以本质上二者并无不同，关键看打开文件时所用的”翻译“方式是否正确。

<br>

# 二、读写文件

C 语言中提供了多种读写文件的方式，以下分别讨论。

## 1、以字符形式读写文件

### 字符读取 fgetc

```int fgetc (FILE *fp);```

fgetc() 读取成功时返回读取到的字符，读取到文件末尾或读取失败时返回 EOF （一般为 -1 ）。

fgetc() 一次读取一个字符，利用循环可以从文件中逐个读取字符：

```c++
while( (ch=fgetc(fp)) != EOF ){
	putchar(ch);
}
```

<br>

### 字符写入 fputc

```int fputc ( char ch, FILE *fp );```

ch 为要写入的字符，fp 为文件指针。fputc() 写入成功时返回写入的字符，失败时返回 EOF。

同样利用循环可以实现逐个字符写入：

```c++
while ( (ch=getchar()) != '\n' ){
	fputc(ch,fp);
}
```

<br>

## 2、以字符串形式读写文件

### 读字符串 fgets

```char *fgets ( char *str, int n, FILE *fp );```

str 为字符数组，n 为要读取的字符数目，fp 为文件指针。

返回值：读取成功时返回字符数组首地址，也即 str；读取失败时返回 NULL；如果开始读取时文件内部指针已经指向了文件末尾，那么将读取不到任何字符，也返回 NULL。

注意：读取到的字符串会在末尾自动添加 '\0' ，即如果想要读取 100 个字符，则 n 的大小应设为 101 。

在读取到 n-1 个字符之前如果出现了换行，或者读到了文件末尾，则读取结束。这就意味着，不管 n 的值多大，fgets() 最多只能读取一行数据，不能跨行。所以我们可以通过设置大 n 来实现按行读取。

```c++
while(fgets(str, N, fp) != NULL){
	printf("%s", str);
}
```

<br>

### 写字符串 fputs

```int fputs( char *str, FILE *fp );```

str 为要写入的字符串，fp 为文件指针。写入成功返回非负数，失败返回 EOF。



# 三、关闭文件

```int fclose(FILE *fp);```

使用```fclose(fp);```关闭文件。文件正常关闭时，fclose() 的返回值为0，如果返回非零值则表示有错误发生。

